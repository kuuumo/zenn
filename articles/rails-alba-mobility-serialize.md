---
title: "[Rails] Albaã¨Mobilityã‚’åˆ©ç”¨ã—ã¦ãƒ¢ãƒ‡ãƒ«ã®å±æ€§ã‚’å¤šè¨€èªå¯¾å¿œã§ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã™ã‚‹"
emoji: "ğŸŒ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [Rails, Alba, Mobility, i18n, Serialize]
published: false
---

## ã¯ã˜ã‚ã«

ã“ã®è¨˜äº‹ã§ã¯ã€Mobilityã§å¤šè¨€èªå¯¾å¿œã—ãŸãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’Albaã§ç°¡å˜ã«JSONã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦ç´¹ä»‹ã—ã¾ã™ã€‚

ã“ã®æ–¹æ³•ã‚’ä½¿ãˆã°ã€è¨€èªã”ã¨ã«ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ãªãã€å…¨ã¦ã®è¨€èªã«å¯¾å¿œã—ãŸãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ä¸€åº¦ã«ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã§ãã¾ã™ã€‚

## å®Ÿè£…ã®èƒŒæ™¯

ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚’Reactã§å®Ÿè£…ã—ã¦ã„ã‚‹éš›ã«ã€ç¿»è¨³ã«ãŠã„ã¦ä¸‹è¨˜ã®å•é¡ŒãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚
ãã‚Œã‚‰ã‚’è§£æ±ºã™ã‚‹ãŸã‚ã«å…¨ã¦ã®ç¿»è¨³ã‚’APIã§ä¸€åº¦ã«è¿”ã™æ–¹æ³•ã‚’æ¡ç”¨ã—ã¾ã—ãŸã€‚
1. ãƒªã‚½ãƒ¼ã‚¹ã®ç¿»è¨³ã‚’é›†ç´„:
    - å„ãƒªã‚½ãƒ¼ã‚¹ã®ç¿»è¨³ã‚’ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã«é›†ç´„ã—ãŸã„ã¨è€ƒãˆã¾ã—ãŸã€‚ã—ã‹ã—ã€ã“ã®æ–¹æ³•ã§ã¯ã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§è¨€èªã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ãŸã³ã«ã€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‹ã‚‰ç¿»è¨³æ¸ˆã¿ãƒªã‚½ãƒ¼ã‚¹ã‚’å†å–å¾—ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã—ãŸã€‚
2. ç¿»è¨³ã®åæ˜ ã®é…å»¶:
    - ä¸Šè¨˜ã®å•é¡Œã‚’è§£æ±ºã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§è¨€èªã‚’åˆ‡ã‚Šæ›¿ãˆãŸéš›ã«ã€ãƒªã‚½ãƒ¼ã‚¹ã®ç¿»è¨³ãŒå³åº§ã«åæ˜ ã•ã‚Œãšã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ãŒæãªã‚ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã—ãŸã€‚
    - ã¾ãŸç¿»è¨³ã®åæ˜ ã®ãŸã‚ã«ç„¡é§„ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚„ã€è¨˜è¿°ãŒå¢—ãˆã¦ã—ã¾ã„ã¾ã™ã€‚

ã“ã‚Œã‚’è§£æ±ºã™ã‚‹ãŸã‚ã€å…¨ã¦ã®ç¿»è¨³ã‚’ä¸€åº¦ã«APIã§è¿”ã™æ–¹æ³•ã‚’æ¡ç”¨ã—ã¾ã—ãŸã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§è¨€èªã‚’åˆ‡ã‚Šæ›¿ãˆã¦ã‚‚APIã®è¿½åŠ ãƒªã‚¯ã‚¨ã‚¹ãƒˆãªã—ã§ãƒªã‚½ãƒ¼ã‚¹ã®å¤šè¨€èªå¯¾å¿œãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚

ãªãŠã€å¤§é‡ã®ãƒ†ã‚­ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’æ‰±ã†å ´åˆã¯ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®å•é¡ŒãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã€çŠ¶æ³ã«å¿œã˜ã¦åˆ¥ã®å¯¾å¿œã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚

## å‡ºåŠ›ã‚¤ãƒ¡ãƒ¼ã‚¸

```ruby
post = Post.create(title_ja: "è¨˜äº‹ã‚’æ›¸ã„ã¦ã¿ãŸ", title_en: "I wrote an article", ...)
PostResource.new(post).serializable_hash
=> {
  "id" => 1,
  ...
  "title_ja" => "è¨˜äº‹ã‚’æ›¸ã„ã¦ã¿ãŸ",
  "title_en" => "I wrote an article",
  ...
}
```

## å®Ÿéš›ã®ã‚³ãƒ¼ãƒ‰

ã¾ãšã€titleã¨descriptionã‚’Mobilityã§å›½éš›åŒ–å¯¾å¿œã—ã¦ã„ã‚‹Postãƒ¢ãƒ‡ãƒ«ã‚’å®šç¾©ã—ã¾ã™ã€‚

```ruby:app/models/post.rb
class Post < ApplicationRecord
  include Mobility
  translates :title, :sub_title
  ...
end
```

æ¬¡ã«ã€Albaã®resourceã®ãƒ™ãƒ¼ã‚¹ã‚¯ãƒ©ã‚¹ApplicationResourceã‚’ä½œæˆã—ã€ã“ã“ã«`i18n_attributes`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¿½åŠ ã—ã¾ã™ã€‚ã“ã®ãƒ¡ã‚½ãƒƒãƒ‰ã§ã¯ã€ä»¥ä¸‹ã®ã“ã¨ã‚’è¡Œã„ã¾ã™ï¼š
- å¼•æ•°ã¨ã—ã¦å›½éš›åŒ–å¯¾å¿œã™ã‚‹å±æ€§ã®æ–‡å­—åˆ—ã¾ãŸã¯ã‚·ãƒ³ãƒœãƒ«ã‚’è¤‡æ•°å—ã‘å–ã‚‹
- `config/application.rb`ã§è¨­å®šã•ã‚Œã¦ã„ã‚‹ä½¿ç”¨å¯èƒ½ãªè¨€èªã«å¿œã˜ã¦ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã™ã‚‹å±æ€§ã‚’æŒ‡å®šã™ã‚‹

```ruby:app/resources/application_resource.rb
class ApplicationResource
  include Alba::Resource
  ...
  # Set multiple i18n attributes at once
  #
  # @param attrs [Array<String, Symbol>]
  def self.i18n_attributes(*attrs)
    attrs.each do |attr|
      I18n.available_locales.each do |locale|
        attribute Mobility.normalize_locale_accessor(attr, locale)
      end
    end
  end
  ...
end
```

æœ€å¾Œã«ã€PostResourceã‚’ä½œæˆã—ã€å…ˆã»ã©ã®`i18n_attributes`ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚

```ruby:app/resources/post_resource.rb
class PostResource < ApplicationResource
  attributes :id, ...

  i18n_attributes :title, :sub_title
end
```

## ä½¿ç”¨ã—ãŸGem

### Alba

[Alba](https://github.com/okuramasafumi/alba)ã¯ã€Rubyã€JRubyã€TruffleRubyç”¨ã®JSONã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¶ãƒ¼ã§ã™ã€‚  
ï¼ˆReadmeã‚ˆã‚Šå¼•ç”¨ & deeplç¿»è¨³ï¼‰

### Mobility

[Mobility](https://github.com/shioyama/mobility?tab=readme-ov-file#mobility)ã¯ã€ç¿»è¨³ã‚’ã‚¯ãƒ©ã‚¹ã®å±æ€§ã¨ã—ã¦ä¿å­˜ãƒ»å–å¾—ã™ã‚‹ãŸã‚ã®gemã§ã™ã€‚ã“ã‚Œã‚‰ã®ç¿»è¨³ã¯ã€ãƒ–ãƒ­ã‚°è¨˜äº‹ã®å†…å®¹ã€ç”»åƒã®ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ã€ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã®ã‚¿ã‚°ãªã©ã€ç•°ãªã‚‹è¨€èªã§ä¿å­˜ã—ãŸã„ã‚‚ã®ã§ã‚ã‚Œã°ä½•ã§ã‚‚å¯èƒ½ã§ã™ã€‚ï¼ˆReadmeã‚ˆã‚Šå¼•ç”¨ & deeplç¿»è¨³ï¼‰

## æœ€å¾Œã«

èª¤ã‚Šã‚„æ”¹å–„ç‚¹ã€ã‚¢ãƒ‰ãƒã‚¤ã‚¹ãªã©ãŒã‚ã‚Œã°ã€ãœã²ã‚³ãƒ¡ãƒ³ãƒˆã§æ•™ãˆã¦ãã ã•ã„ï¼
